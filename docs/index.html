<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="radix" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
  <title>Wikipedia Trends</title>
  
  <meta property="description" itemprop="description" content="This is the endproduct of a seminar on data visualisation, showing views per day of a set of Wikipedia articles."/>
  
  
  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2020-02-07"/>
  <meta property="article:created" itemprop="dateCreated" content="2020-02-07"/>
  <meta name="article:author" content="Aaron Peikert"/>
  
  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Wikipedia Trends"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="This is the endproduct of a seminar on data visualisation, showing views per day of a set of Wikipedia articles."/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="Wikipedia Trends"/>
  
  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Wikipedia Trends"/>
  <meta property="twitter:description" content="This is the endproduct of a seminar on data visualisation, showing views per day of a set of Wikipedia articles."/>
  
  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output"]}},"value":[{"type":"character","attributes":{},"value":["Wikipedia Trends"]},{"type":"character","attributes":{},"value":["This is the endproduct of a seminar on data visualisation, showing views per day of a set of Wikipedia articles.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Aaron Peikert"]},{"type":"character","attributes":{},"value":["https://github.com/aaronpeikert"]}]}]},{"type":"character","attributes":{},"value":["2020-02-07"]},{"type":"character","attributes":{},"value":["radix::radix_article"]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  
  <script type="application/javascript">
  
    window.headroom_prevent_pin = false;
  
    window.document.addEventListener("DOMContentLoaded", function (event) {
  
      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');
  
      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });
  
      // responsive menu
      $('.radix-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });
  
      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>
  
  <style type="text/css">
  
  /* Theme (user-documented overrideables for nav appearance) */
  
  .radix-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #455a64;
    font-size: 15px;
    font-weight: 300;
  }
  
  .radix-site-nav a {
    color: inherit;
    text-decoration: none;
  }
  
  .radix-site-nav a:hover {
    color: white;
  }
  
  @media print {
    .radix-site-nav {
      display: none;
    }
  }
  
  .radix-site-header {
  
  }
  
  .radix-site-footer {
  
  }
  
  
  /* Site Header */
  
  .radix-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }
  
  .radix-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }
  
  @media screen and (max-width: 768px) {
    .radix-site-header .nav-left {
      margin-left: 0;
    }
  }
  
  
  .radix-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }
  
  .radix-site-header a,
  .radix-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }
  
  .radix-site-header .title {
    font-size: 18px;
  }
  
  .radix-site-header .logo {
    padding: 0;
  }
  
  .radix-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }
  
  .radix-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }
  
  
  
  @media screen and (min-width: 1000px) {
    .radix-site-header .logo img {
      display: inline-block;
    }
    .radix-site-header .nav-left {
      margin-left: 20px;
    }
    .radix-site-header .nav-right {
      margin-right: 20px;
    }
    .radix-site-header .title {
      padding-left: 12px;
    }
  }
  
  
  .radix-site-header .nav-toggle {
    display: none;
  }
  
  .nav-dropdown {
    display: inline-block;
    position: relative;
  }
  
  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }
  
  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }
  
  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .nav-dropdown-active {
    display: block;
  }
  
  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }
  
  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }
  
  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }
  
  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }
  
  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }
  
  @media screen and (max-width: 768px) {
    .radix-site-header a, .radix-site-header .nav-dropdown  {display: none;}
    .radix-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .radix-site-header .title {
      margin-left: 0;
    }
    .radix-site-header .nav-right {
      margin-right: 0;
    }
    .radix-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }
  
  
  @media screen and (max-width: 768px) {
    .radix-site-header.responsive {position: relative;}
    .radix-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .radix-site-header.responsive a,
    .radix-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .radix-site-header.responsive .nav-left,
    .radix-site-header.responsive .nav-right {
      width: 100%;
    }
    .radix-site-header.responsive .nav-dropdown {float: none;}
    .radix-site-header.responsive .nav-dropdown-content {position: relative;}
    .radix-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }
  
  /* Site Footer */
  
  .radix-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }
  
  /* Headroom */
  
  d-title {
    padding-top: 6rem;
  }
  
  @media print {
    d-title {
      padding-top: 4rem;
    }
  }
  
  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }
  
  .headroom--transition {
    transition: all .4s ease-in-out;
  }
  
  .headroom--unpinned {
    top: -100px;
  }
  
  .headroom--pinned {
    top: 0;
  }
  
  </style>
  
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->
  
  <style type="text/css">
  
  body {
    background-color: white;
  }
  
  .pandoc-table {
    width: 100%;
  }
  
  .pandoc-table>caption {
    margin-bottom: 10px;
  }
  
  .pandoc-table th:not([align]) {
    text-align: left;
  }
  
  .pagedtable-footer {
    font-size: 15px;
  }
  
  .html-widget {
    margin-bottom: 2.0em;
  }
  
  .l-screen-inset {
    padding-right: 16px;
  }
  
  .l-screen .caption {
    margin-left: 10px;
  }
  
  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .shaded-content {
    background: white;
  }
  
  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }
  
  .hidden {
    display: none !important;
  }
  
  d-article {
    padding-bottom: 30px;
  }
  
  d-appendix {
    padding-top: 30px;
  }
  
  d-article>p>img {
    width: 100%;
  }
  
  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }
  
  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  /* CSS for table of contents */
  
  .d-toc {
    color: rgba(0,0,0,0.8);
    font-size: 0.8em;
    line-height: 1em;
  }
  
  .d-toc-header {
    font-size: 0.6rem;
    font-weight: 400;
    color: rgba(0, 0, 0, 0.5);
    text-transform: uppercase;
    margin-top: 0;
    margin-bottom: 1.3em;
  }
  
  .d-toc a {
    border-bottom: none;
  }
  
  .d-toc ul {
    padding-left: 0;
  }
  
  .d-toc li>ul {
    padding-top: 0.8em;
    padding-left: 16px;
    margin-bottom: 0.6em;
  }
  
  .d-toc ul,
  .d-toc li {
    list-style-type: none;
  }
  
  .d-toc li {
    margin-bottom: 0.9em;
  }
  
  .d-toc-separator {
    margin-top: 20px;
    margin-bottom: 2em;
  }
  
  .d-article-with-toc {
    border-top: none;
    padding-top: 0;
  }
  
  
  
  /* Tweak code blocks (note that this CSS is repeated above in an injection
     into the d-code shadow dom) */
  
  d-code {
    overflow-x: auto !important;
  }
  
  pre.d-code code.d-code {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }
  
  pre.text-output {
  
    font-size: 12px;
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  @media(min-width: 768px) {
  
  d-code {
    overflow-x: visible !important;
  }
  
  pre.d-code code.d-code  {
      padding-left: 18px;
      font-size: 14px;
  }
  pre.text-output {
    font-size: 14px;
  }
  }
  
  /* Figure */
  
  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }
  
  .figure img {
    width: 100%;
  }
  
  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }
  
  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }
  
  
  
  /* Tweak 1000px media break to show more text */
  
  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }
  
    .grid {
      grid-column-gap: 16px;
    }
  
    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }
  
  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }
  
    .grid {
      grid-column-gap: 32px;
    }
  }
  
  
  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */
  
  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  
  /* Social footer */
  
  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }
  
  .disqus-comments {
    margin-right: 30px;
  }
  
  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }
  
  #disqus_thread {
    margin-top: 30px;
  }
  
  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }
  
  .article-sharing a:hover {
    border-bottom: none;
  }
  
  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .subscribe p {
    margin-bottom: 0.5em;
  }
  
  
  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }
  
  
  /* Improve display for browsers without grid (IE/Edge <= 15) */
  
  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }
  
  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }
  
  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }
  
  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }
  
  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }
  
  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }
  
  
  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }
  
  .downlevel .footnotes ol {
    padding-left: 13px;
  }
  
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }
  
  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }
  
  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }
  
  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  </style>
  
  <script type="application/javascript">
  
  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }
  
  // show body when load is complete
  function on_load_complete() {
  
    // set body to visible
    document.body.style.visibility = 'visible';
  
    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }
  
    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }
  
  function init_distill() {
  
    init_common();
  
    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);
  
    // create d-title
    $('.d-title').changeElementType('d-title');
  
    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);
  
    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();
  
    // move posts container into article
    $('.posts-container').appendTo($('d-article'));
  
    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');
  
    // create d-bibliography
    var bibliography = $('<d-bibliography></d-bibliography>');
    $('#distill-bibliography').wrap(bibliography);
  
    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;
  
    // replace citations with <d-cite>
    $('.citation').each(function(i, val) {
      appendix = true;
      var cites = $(this).attr('data-cites').split(" ");
      var dt_cite = $('<d-cite></d-cite>');
      dt_cite.attr('key', cites.join());
      $(this).replaceWith(dt_cite);
    });
    // remove refs
    $('#refs').remove();
  
    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();
  
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-toc a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });
  
    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');
  
    // replace code blocks with d-code
    $('pre>code').each(function(i, val) {
      var code = $(this);
      var pre = code.parent();
      var clz = "";
      var language = pre.attr('class');
      if (language) {
        // map unknown languages to "clike" (without this they just dissapear)
        if ($.inArray(language, ["bash", "clike", "css", "go", "html",
                                 "javascript", "js", "julia", "lua", "markdown",
                                 "markup", "mathml", "python", "svg", "xml"]) == -1)
          language = "clike";
        language = ' language="' + language + '"';
        var dt_code = $('<d-code block' + language + clz + '></d-code>');
        dt_code.text(code.text());
        pre.replaceWith(dt_code);
      } else {
        code.addClass('text-output').unwrap().changeElementType('pre');
      }
    });
  
    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {
  
      // capture layout
      var layout = $(this).attr('data-layout');
  
      // apply layout to markdown level block elements
      var elements = $(this).children().not('d-code, pre.text-output, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });
  
  
      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });
  
    // load distill framework
    load_distill_framework();
  
    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {
  
      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;
  
      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');
  
      // table of contents
      if (have_authors) // adjust border if we are in authors
        $('.d-toc').parent().addClass('d-article-with-toc');
  
      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');
  
      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }
  
      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');
  
      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");
  
      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }
  
       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }
  
      // inject pre code styles (can't do this with a global stylesheet b/c a shadow root is used)
      $('d-code').each(function(i, val) {
        var style = document.createElement('style');
        style.innerHTML = 'pre code { padding-left: 10px; font-size: 12px; border-left: 2px solid rgba(0,0,0,0.1); } ' +
                          '@media(min-width: 768px) { pre code { padding-left: 18px; font-size: 14px; } }';
        if (this.shadowRoot)
          this.shadowRoot.appendChild(style);
      });
  
      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();
  
      // clear polling timer
      clearInterval(tid);
  
      // show body now that everything is ready
      on_load_complete();
    }
  
    var tid = setInterval(distill_post_process, 50);
    distill_post_process();
  
  }
  
  function init_downlevel() {
  
    init_common();
  
     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));
  
    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
  
    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();
  
    // remove toc
    $('.d-toc-header').remove();
    $('.d-toc').remove();
    $('.d-toc-separator').remove();
  
    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });
  
  
    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);
  
    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);
  
    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();
  
    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();
  
    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));
  
    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });
  
    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));
  
    $('body').addClass('downlevel');
  
    on_load_complete();
  }
  
  
  function init_common() {
  
    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};
  
        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });
  
        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);
  
    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});
  
    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });
  
      }
    });
  
    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });
  
    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.radix-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }
  
    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');
  
    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");
  
    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();
  
    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });
  
  </script>
  
  <!--/radix_placeholder_distill-->
  <script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Wikipedia Trends","description":"This is the endproduct of a seminar on data visualisation, showing views per day of a set of Wikipedia articles.","authors":[{"author":"Aaron Peikert","authorURL":"https://github.com/aaronpeikert","affiliation":"&nbsp;","affiliationURL":"#"}],"publishedDate":"2020-02-07T00:00:00.000+01:00","citationText":"Peikert, 2020"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="radix-site-nav radix-site-header">
<div class="nav-left">
<a href="index.html" class="title">Wikipedia Trends</a>
</div>
<div class="nav-right">
<a href="https://github.com/aaronpeikert/wiki-trends">
<i class="fab fa-github"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Wikipedia Trends</h1>
<p>This is the endproduct of a seminar on data visualisation, showing views per day of a set of Wikipedia articles.</p>
</div>

<div class="d-byline">
  Aaron Peikert <a href="https://github.com/aaronpeikert" class="uri">https://github.com/aaronpeikert</a> 
  
<br/>2020-02-07
</div>

<div class="d-article">
<iframe src="https://aaronpeikert.shinyapps.io/wiki-trends/" class="l-screen-inset" height="800px">
</iframe>
<h2 id="aim">Aim</h2>
<p>This plot should enable you to explore possible trends and patterns quickly. To that end, it combines the strengths of human perception with the perks of automatic data preprocessing. The human is good at finding large general patterns and judge similarity by it. The computer, on the other hand, excels at averaging data points that are either many (weekly trends) or far from each other (yearly trends) or cluster data based on small highly frequent patterns. However, this visualisation fails to tell a coherent story with the data. Telling this story was — as I realised too late — an aim of this seminar. My only hope is that this plot enables others to find interesting stories to tell (with graphics).</p>
<h2 id="background-story">Background Story</h2>
<h3 id="getting-the-data">Getting the Data</h3>
<p>The data is scraped via a rest API that is provided by Wikipedia for this purpose. Oliver Keyes develops a thin wrapper around this restful API for R in the form of the <a href="https://github.com/Ironholds/pageviews/tree/d32c629c4589765e8c8d638a8a3f315481710120"><code>pageview</code> package</a> (note that this project uses the GitHub version fixed on the commit <code>d32c629</code>). <a href="https://wikimedia.org/api/rest_v1/?doc">More information about the restful API.</a> I scrape a list of articles about several drugs, from the English Wikipedia from the first day of 2015 till the last of 2019.</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
get_articles &lt;- function(articles, start, end){
  article_pageviews(
    project = c(&quot;en.wikipedia&quot;),
    article = articles,
    platform = c(&quot;desktop&quot;, &quot;mobile-web&quot;, &quot;mobile-app&quot;),
    start = pageview_timestamps(start),
    end = pageview_timestamps(end)
  )
}</code></pre>
</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
psych_active &lt;- c(
  &quot;Alcohol&quot;,
  &quot;Nicotine&quot;,
  &quot;Caffeine&quot;,
  &quot;Cannabis&quot;,
  &quot;Methamphetamine&quot;,
  &quot;Cocaine&quot;,
  &quot;Heroin&quot;,
  &quot;Ecstasy&quot;,
  &quot;Fentanyl&quot;
)

start &lt;- ymd(&quot;2015-01-01&quot;)
end &lt;- ymd(&quot;2019-12-31&quot;)
views &lt;- get_articles(psych_active, start, end)</code></pre>
</div>
<h3 id="remove-outliers">Remove outliers</h3>
<p>Wikipedia seems to make some errors now and then (or more precisely there are sometimes issues with how articles are redirected). So I estimate the winsorized mean and standard deviation (sd) and remove (set to <code>NA</code>) values that lie beyond four (winsorized) sd above the (winsorized) mean. This estimation is pooled overall device types and agents.</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
remove_outliers &lt;- function(views){
  views %&gt;%
    # sum over devices and agents
    group_by(article, date) %&gt;%
    summarise(views = sum (views)) %&gt;% 
    # remove extremes
    mutate(trimed_mean = winsor.mean(views, trim = 0.05),
           trimed_sd = winsor.sd(views, trim = .05),
           cutoff = trimed_mean + 4*trimed_sd,
           views = if_else(views &lt; cutoff, views, NA_real_),
           date = as_date(date)) %&gt;% 
    ungroup()
}</code></pre>
</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
views &lt;- remove_outliers(views)</code></pre>
</div>
<h1 id="first-impression">First Impression</h1>
<p>We have three dimensions that are of interest and hence are target of the visualisation: <code>date</code>, <code>article</code> and <code>number of views</code> (views from now on).</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
views %&gt;% 
  ggplot(aes(date, views, group = article, color = article)) +
  geom_line()</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-3-1.png" width="1950" /></p>
</div>
<p>This first inspection reveals two interesting problems I will focus on — beyond that this is not too pleasing graphics overall. First, the average and variability of these articles views are quite different (ever heard about Fentanyl?). That warrants an approach on how to scale. Second, we have a rather high frequency that may hide some exciting patterns. The general approach to address these issues is to decompose the signal into regular patterns, most notably recurring patterns and long term trends.</p>
<h1 id="decompose-patterns">Decompose Patterns</h1>
<p>A first step to address these two problems is to apply a smoothing filter. To that end, I will convert this into a time series format to apply rolling functions over the date. The rolling mean and sd over 365 days are used to approximate the long term differences between the articles averages and variabilities.</p>
<div class="layout-chunk" data-layout="l-page">

</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
views &lt;- extract_trend(views)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
views %&gt;% 
  ggplot(aes(date, trend, group = article, color = article)) +
  geom_line()</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-5-1.png" width="1950" /></p>
<pre class="r"><code>
views %&gt;% 
  ggplot(aes(date, trend_sd, group = article, color = article)) +
  geom_line()</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-5-2.png" width="1950" /></p>
</div>
<p>Substrating the rolling mean and dividing by the rolling sd results into a flexible z-standardisation. So let’s plot the first graphic again.</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
views %&gt;% 
  ggplot(aes(date, views_std, group = article)) + geom_line(alpha = .3)</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-6-1.png" width="1950" /></p>
</div>
<p>Besides that this plot is now uninformative about any differences between the articles, it gets clear that these articles share a not so small portion of their variance across the date. So I partitioned the date variable into repeating date patterns.</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
add_dates &lt;- function(views){
  mutate(views,
         year = year(date),
         month = month(date),
         week = week(date),
         day = day(date),
         wday = wday(date),
         doy = yday(date))
}</code></pre>
</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
views &lt;- add_dates(views)</code></pre>
</div>
<p>I think some of the higher frequency comes from differences over weekdays.</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
extract_wday_trend &lt;- function(views) {
  views %&gt;%
    as_tibble() %&gt;%
    group_by(article, wday) %&gt;%
    mutate(views_wday = mean(views_std, na.rm = TRUE)) %&gt;%
    ungroup()
}</code></pre>
</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
views &lt;- extract_wday_trend(views)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
plot_wday_ &lt;- views %&gt;% 
  ggplot(aes(wday, views_wday, group = article, color = article)) +
  geom_line() + theme_minimal()
plot_wday_</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-9-1.png" width="1950" /></p>
</div>
<p>This type of pattern is practically made for a polar coordinate system.</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
plot_wday_ + coord_polar()</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-10-1.png" width="1950" /></p>
</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
extract_year_trend &lt;- function(views){
  views_year &lt;- views %&gt;%
    group_by(article, doy) %&gt;% 
    summarise(views = mean(views_std - views_wday, na.rm = TRUE)) %&gt;% 
    list() %&gt;% 
    rep(3) %&gt;% 
    bind_rows() %&gt;% 
    group_by(article) %&gt;% 
    mutate(doy2 = 1,
           doy2 = cumsum(doy2)) %&gt;% 
    as_tsibble(article, doy2) %&gt;% 
    mutate(
      views_year = slide_dbl(
        views,
        mean,
        na.rm = TRUE,
        .size = 30,
        .align = &quot;center-left&quot;
      )) %&gt;% 
    as_tibble() %&gt;% 
    ungroup() %&gt;% 
    filter(between(doy2, max(doy), (2*max(doy)) - 1)) %&gt;% 
    select(article, doy, views_year)
  left_join(views, views_year, by = c(&quot;article&quot;, &quot;doy&quot;))
}</code></pre>
</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
views &lt;- extract_year_trend(views)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
plot_year &lt;- function(views) {
  months &lt;- c(&quot;J&quot;, &quot;F&quot;,&quot;M&quot;, &quot;A&quot;, &quot;M&quot;, &quot;J&quot;, &quot;J&quot;, &quot;A&quot;, &quot;S&quot;, &quot;O&quot;, &quot;N&quot;, &quot;D&quot;, &quot;&quot;)
  months &lt;- c(12, 2:11, 1)
  breaks_year &lt;- function(x)seq(x[1], x[2], length.out = 12)
  views %&gt;%
    ggplot(aes(doy, views_year, group = article, color = article)) +
    geom_hline(yintercept = 0, color = &quot;darkgrey&quot;, size = 0.3) +
    geom_line() +
    coord_polar() +
    theme_minimal() +
    scale_x_continuous(&quot;Months&quot;, breaks = breaks_year, labels = months) +
    theme(panel.grid.minor = element_blank()) +
    theme_text
}</code></pre>
</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
plot_year(views)</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-12-1.png" width="1950" /></p>
</div>
<p>Having extracted the patterns, I can remove them from the overall data and scale it back. Additionally, I create a ten-day smoothed version of the views without a pattern.</p>
<div class="layout-chunk" data-layout="l-page">

</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
views &lt;- remove_pattern(views)</code></pre>
</div>
<p>I create a plot that conveys both the raw data and the smoothed trend (smooth views without pattern +/- 1sd).</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
plot_year &lt;- function(views) {
  months &lt;- c(&quot;J&quot;, &quot;F&quot;,&quot;M&quot;, &quot;A&quot;, &quot;M&quot;, &quot;J&quot;, &quot;J&quot;, &quot;A&quot;, &quot;S&quot;, &quot;O&quot;, &quot;N&quot;, &quot;D&quot;, &quot;&quot;)
  months &lt;- c(12, 2:11, 1)
  breaks_year &lt;- function(x)seq(x[1], x[2], length.out = 12)
  views %&gt;%
    ggplot(aes(doy, views_year, group = article, color = article)) +
    geom_hline(yintercept = 0, color = &quot;darkgrey&quot;, size = 0.3) +
    geom_line() +
    coord_polar() +
    theme_minimal() +
    scale_x_continuous(&quot;Months&quot;, breaks = breaks_year, labels = months) +
    theme(panel.grid.minor = element_blank()) +
    theme_text
}</code></pre>
</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
plot_year(views)</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-14-1.png" width="1950" /></p>
</div>
<h3 id="clustering">Clustering</h3>
<p>Another source of visual clutter is that we consider 9 (possibly more) articles. That stretches the boundary of what can be effectively encoded in colour. That is further complicated by the fact that they are more or less similar in shape. A possible remedy is to cluster the different articles into groups that are similar in their overall shape. How to define similarity in the context of time-series is a complicated and well studies topic that is certainly beyond the scope of this project. However, some critical consideration may be noted. By choosing to scale the series, we deemed the differences between grand average and variability as uninteresting, which should be considered in how we operationalise similarity (because we only want similarity in thinks we consider essential). Also, because I have no domain knowledge about the articles under study and the long term goal of building an interactive dashboard, we want a similarity definition that is parameter-free. To my knowledge, there is only one similarity measure that satisfies both: cross-entropy. Conceptually it may be understood as a measure that defines how much information the one time series caries over another, by assessing how many bits may be saved when the one is used to compress the other and visa versa. This is formalised as the complexity of one measure plus the Kullback–Leibler divergence between the two. While both terms of this sum are generally hard to compute some good approximation, have been found. One solution uniquely suited to time series analysis is permutation distribution clustering. It takes the permutation distribution as a proxy for the required measure of complexity and the squared Hellinger distance as a proxy for the Kullback–Leibler divergence.</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
cluster_ts &lt;- function(data, nclust, id_cols, names_from, values_from){
  id_cols &lt;- enquo(id_cols)
  names_from &lt;- enquo(names_from)
  values_from &lt;- enquo(values_from)
  wide &lt;- pivot_wider(data,
                      id_cols = !!id_cols,
                      names_from = !!names_from,
                      values_from = !!values_from) %&gt;% 
    select(-c(!!id_cols))
  dist &lt;- pdcDist(as.matrix(wide))
  out &lt;- tibble(cluster = kmed::fastkmed(dist, nclust, iterate = 100)$cluster,
                article = names(wide))
  recode_by_size &lt;- function(x) {
    t &lt;- table(x)
    size &lt;- order(t)
    out &lt;- names(t)
    names(out) &lt;- size
    as.numeric(recode(x, !!!out))
  }
  out &lt;- mutate(out, cluster = recode_by_size(cluster))
  out
}
add_cluster &lt;- function(views, nclust){
  cluster &lt;- cluster_ts(
    views,
    nclust = nclust,
    id_cols = date,
    names_from = article,
    values_from = views_std
  )
  views %&gt;% select(-starts_with(&quot;cluster&quot;)) %&gt;% 
    left_join(cluster, by = &quot;article&quot;)
}
break_clusters &lt;- function(views){
  arrange(nest(group_by(views, cluster)), cluster)$data
}</code></pre>
</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
views &lt;- add_cluster(views, 3)
clusters &lt;- break_clusters(views)</code></pre>
</div>
<p>Lets plot it crudely.</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
plot_alltime(views) + facet_wrap(~cluster, scales = &quot;free_y&quot;, ncol = 1)</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-16-1.png" width="1950" /></p>
</div>
<h1 id="align-plots">Align Plots</h1>
<p>Now we have three plots representing the reoccurring week and year pattern and the full timeline grouped into clusters.</p>
<p>I imagine a visual arrangement where each row represents a cluster, and each column a timeframe — Let’s begin with the arrangement of a single row.</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
cluster1 &lt;- filter(views, cluster == 1)
plot_wday(cluster1) +
  plot_year(cluster1) +
  plot_alltime(cluster1) &amp;
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-17-1.png" width="1950" /></p>
</div>
<p>And first I’ll align the polar plots, so they share a common y-axis.</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
remove_legend &lt;- theme(legend.position = &quot;none&quot;)
remove_y_axis &lt;- theme(
  axis.ticks.y = element_blank(),
  axis.text.y = element_blank(),
  axis.title.y = element_blank()
)
remove_margin &lt;- theme(plot.margin = unit(c(0, 0, 0, 0), &quot;cm&quot;))
get_max_range &lt;- function(plots, axes) {
  limits &lt;- map(plots, function(x)
    layer_scales(x)[[axes]]$range$range)
  limits_lower &lt;- map_dbl(limits, 1)
  limits_upper &lt;- map_dbl(limits, 2)
  c(min(limits_lower), max(limits_upper))
}
replace_data &lt;- function(newdata, plot) {
  plot$data &lt;- newdata
  plot
}
add_layer &lt;- function(plots, ...)map(plots, ...)</code></pre>
</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
prepare_polar &lt;- function(left, right, datas) {
  lefts &lt;- map(datas, replace_data, left)
  rights &lt;- map(datas, replace_data, right)
  polar_range &lt;- get_max_range(c(lefts, rights), &quot;y&quot;)
  lefts &lt;- suppressWarnings(imap(
    lefts,
    ~ .x +
      remove_margin +
      remove_legend +
      scale_y_continuous(limits = polar_range) +
      labs(tag = .y)
  ))
  rights &lt;- suppressWarnings(map(rights, ~ .x +
                                   remove_margin +
                                   remove_legend +
                                   remove_y_axis))
  first_rights &lt;- rights[[1]]
  last_rights &lt;- rights[[length(rights)]]
  rights &lt;- map(rights, ~ .x +
                  theme(axis.text = element_blank(),
                        axis.title = element_blank()))
  rights[[1]] &lt;- first_rights +
    theme(axis.title = element_blank())
  rights[[length(rights)]] &lt;- last_rights +
    theme(axis.text.x = element_blank())
  
  first_lefts &lt;- lefts[[1]] +
    theme(axis.title = element_blank())
  last_lefts &lt;- lefts[[length(lefts)]]
  lefts &lt;- map(lefts, ~ .x +
                 theme(axis.text = element_blank(),
                       axis.title = element_blank()))
  lefts[[1]] &lt;- first_lefts
  lefts[[length(lefts)]] &lt;- last_lefts +
    theme(axis.text = element_blank(),
          axis.title.y = element_blank())
  list(lefts = lefts, rights = rights)
}
align_polar &lt;- function(polar, l = 1, r = 2){
  rows &lt;- seq_along(polar$lefts)
  pos_left &lt;- map(rows, ~area(.x, l, .x, l))
  pos_right &lt;- map(rows, ~area(.x, r, .x, r))
  do.call(c, c(pos_left, pos_right))
}</code></pre>
</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
polar &lt;- prepare_polar(plot_wday(views),
                       plot_year(views),
                       clusters)
wrap_plots(flatten(polar), design = align_polar(polar))</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-18-1.png" width="1950" /></p>
</div>
<p>Now the full timeline.</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
prepare_alltime &lt;- function(plot, datas){
  plots &lt;- map(datas, replace_data, plot)
  plots &lt;- map(plots, ~.x +
                 remove_margin +
                 remove_legend +
                 theme(axis.ticks = element_blank(),
                       axis.title.y = element_blank()) +
                 scale_y_continuous(position = &quot;right&quot;)
  )
  last &lt;- plots[[length(plots)]]
  plots &lt;- map(plots, ~.x +
                 theme(axis.title.x = element_blank(),
                       axis.text.x = element_blank()))
  plots[[length(plots)]] &lt;- last
  plots
}

align_alltime &lt;- function(plots, l, r){
  rows &lt;- seq_along(plots)
  pos &lt;- map(rows, ~area(.x, l, .x, r))
  do.call(c, pos)
}</code></pre>
</div>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
alltime &lt;- prepare_alltime(plot_alltime(views), clusters)
wrap_plots(alltime, design = align_alltime(alltime, 1, 2))</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-19-1.png" width="1950" /></p>
</div>
<h3 id="colour">Colour</h3>
<p>The colours are reused, thus creating visual relations which do not exist in the data. The colour coding for this plot should optimise how well one can distinguish the different articles. A palette which varies the hue, but keeps luminance and chroma as fixed as possible is, in my opinion, a good fit for that task. However, it is of particular importance that they are as also as different as possible within each cluster. Because of the lack of a more sophisticated algorithm, I scramble the order of the colours 100 times and take a sample with the highest sum of squares of hue within each group.</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
article_order &lt;- function(views){
  views %&gt;%
    group_by(cluster, article) %&gt;%
    summarise(mean = mean(views_depattern_smooth, na.rm = TRUE)) %&gt;% 
    arrange(cluster, desc(mean)) %&gt;% 
    select(cluster, article)
}


max_color_diff &lt;- function(color, cluster, n = 100){
  col2hue &lt;- function(x)rgb2hsv(col2rgb(x))[1, ]
  sshue &lt;- function(colors, cluster){
    colors &lt;- tibble(colors, cluster, hue = col2hue(colors)) %&gt;% 
      group_by(cluster) %&gt;%
      summarise(sshue = var(hue))
    mean(colors$sshue, na.rm = TRUE)
  }
  shuffle &lt;- function(x)sample(x, length(x))
  colors &lt;- replicate(n, shuffle(color), simplify = FALSE)
  colors[[which.max(map_dbl(colors, sshue, cluster))]]
}

add_colors &lt;- function(plots, views){
  article_order &lt;- article_order(views)
  colors &lt;- max_color_diff(scales::hue_pal()(length(article_order$article)),
                           article_order$cluster)
  names(colors) &lt;- article_order$article
  add_layer(
    plots,
    ~ .x +
      scale_color_manual(values = colors,
                         breaks = article_order$article) +
      scale_fill_manual(values = colors,
                        breaks = article_order$article)
  )
}</code></pre>
</div>
<p>But a legend is still missing.</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
get_legends &lt;- function(plots){
  map(plots, ~get_legend(.x + theme(legend.position = &quot;right&quot;, legend.text.align = 0, legend.justification = &quot;left&quot;)))
}
align_legends &lt;- function(legends, l, r){
  rows &lt;- seq_along(legends)
  pos &lt;- map(rows, ~area(.x, l, .x, r))
  do.call(c, pos)
}</code></pre>
</div>
<h3 id="final">Final</h3>
<p>So the final plot is:</p>
<div class="layout-chunk" data-layout="l-page">
<pre class="r"><code>
plot_final &lt;- function(views){
  wday &lt;- plot_wday(views)
  year &lt;- plot_year(views)
  alltime &lt;- plot_alltime(views)
  clusters &lt;- break_clusters(views)
  nclust &lt;- length(clusters)
  polar &lt;- prepare_polar(wday, year, clusters)
  alltime &lt;-  prepare_alltime(alltime, clusters)
  plots &lt;- c(flatten(polar), alltime)
  plots &lt;- add_colors(plots, views)
  legends &lt;- get_legends(plots[seq_along(unique(views$cluster))])
  designs &lt;- c(align_polar(polar, 1, 2),
               align_alltime(alltime, 3, 3),
               align_legends(legends, 4, 4))
  plots &lt;- c(plots, legends)
  wrap_plots(plots, design = designs, widths = c(1, 1, 2, 0.5)) +
    plot_annotation(title = &quot;Wikipedia Trends&quot;,
                    caption = &quot;Polar plots (left) show averaged trends in standard deviation, while cartesian plots (right) represents the raw count (shaded area +/- 1SD smothed over ten days).\nTrends shown in plots to the left are removed from plots to the right.\nRows are created by clustering articles by similarity.&quot;,
                    theme = theme(plot.caption = element_text(
                      face = &quot;plain&quot;,
                      colour = &quot;darkgrey&quot;,
                      size = 10),
                      plot.title = element_text(
                        face = &quot;plain&quot;,
                        colour = &quot;darkgrey&quot;,
                        size = 15),
                      plot.margin = margin(10, 10, 10, 10)))
}</code></pre>
</div>
<div class="layout-chunk" data-layout="l-screen-inset">
<pre class="r"><code>
plot_final(views)</code></pre>
<p><img src="index_files/figure-html5/unnamed-chunk-20-1.png" width="4800" /></p>
</div>
<p>You can find the full code on <a href="https://github.com/aaronpeikert/wiki-trends">GitHub</a>.</p>
<h2 id="shortcomings">Shortcomings</h2>
<p>Even after fiddling around quite a while, I was unable to solve two problems. First, the x-axis of the polar plots puts the first and last value on the same angle, second, there is no axis title on the two y-axises which spans the whole plot (I head to revert to the caption for the information on the units). I gave up on these, because <a href="https://www.data-imaginist.com/2017/beneath-the-canvas/">“[…] <code>ggplot2</code> in many ways seems to be fueled by magic and unicorn blood […]”</a>. Another annoying thing is the speed of plotting, which is something I wouldn’t even dare to try to improve.</p>
<p>If I were to recreate this plot, I would do it in D3.js. With D3, I could overcome the shortcomings described above and introduce real interactiveness. ggplot2 inhibits smooth interactions through its lack of speed and general design principles.</p>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
